---
name: guardrails-validation
on:
  push: null
    # paths:
    #   - solutions/guardrails/**
jobs:
  solutions-render:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v1
      - name: kpt fn render guardrails
        run: |
          docker run -v $PWD:/app -v /var/run/docker.sock:/var/run/docker.sock gcr.io/kpt-dev/kpt:v1.0.0-beta.19 fn render /app/solutions/guardrails
      - name: Upload Solution Artifact
        uses: actions/upload-artifact@v3
        with:
          name: lz-render
          path: ./solutions
          retention-days: 1
  solutions-validate:
    runs-on: ubuntu-latest
    needs: solutions-render
    steps:
      - name: Download Solutions
        uses: actions/download-artifact@v3
        with:
          name: lz-render
      - name: dir check
        run: pwd && ls
      - name: nomos vet guardrails
        run: |-
          docker run -v $PWD:/guardrails gcr.io/config-management-release/nomos:v1.13.1 nomos vet --no-api-server-check --source-format unstructured --path /guardrails/guardrails/configs
